---
title: 임상연구 설계와 분석을 위한 통계 방법
# subtitle: Penalized Regression Approach for Multivariate Analysis of Spectroscopy Data
author: \textbf{Boncho Ku}, Ph.D., Senior researcher
institute: KM Fundamental Research Division, Korea Institute of Oriental Medicine
date: $16^{\mathrm{th}}$ November, 2017
output: 
  beamer_presentation: 
    fonttheme: serif
    includes:
      in_header: presentation-header-new.tex
      incremental: no
    keep_tex: yes
    slide_level: 2
    theme: metropolis
    toc: no
urlcolor: blue
classoption: xcolor=dvipsnames
fontsize: 9pt
geometry: paperwidth=297mm, paperheight=210mm, textwidth=247mm, textheight=154.6mm
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r knitr_init, echo=FALSE, results="hide", message=FALSE, cache=FALSE}
knitr::opts_knit$set(root.dir = '..')
options(max.print = 10000)
knitr::opts_chunk$set(eval = TRUE,
                      echo = FALSE,
                      cache = FALSE,
                      include = TRUE,
                      collapse = FALSE,
                      tidy=TRUE,
                      message=FALSE,
                      warning=FALSE,
                      dependson = NULL,
                      engine = "R", # Chunks will always have R code, unless noted
                      error = TRUE,
                      fig.path="Figures/",  # Set the figure options
                      fig.align = "center",
                      fig.width = 7,
                      fig.height = 7,
                      fig.keep='all', fig.retina=2)
```

```{r Initialization, echo = F, results = "hide", message = F, cache = F}
rm(list = ls())
library(MASS)
library(reshape2)
library(plyr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(stringr)
library(lubridate)
library(ChemoSpec)
library(prospectr)
library(inspectr)
library(pls)
library(rmarkdown)
library(knitr)
library(moonBook)
library(ztable)
library(htmlTable)
library(ggthemes)
library(grid)
library(gridExtra)
library(latex2exp)
library(nlme)
library(lsmeans)
library(car)
library(multcomp)
library(xtable)
library(kableExtra)
library(viridis)
library(GGally)
library(RColorBrewer)
library(Hmisc)

options(knitr.table.format = "latex")
```

# Chapter I: \LARGE{Overview of Statistics}

## Famous quotes about statistics

\begin{mdframed}[backgroundcolor = gray!30]

\textit{There are three types of lies: lies, damn lies, and \textbf{STATISTICS}} (Benjamin Disraeli)

\textit{Fact are stubborn things, but \textbf{STATISTICS} are pliable} (Mark Twain)

and so on ...

\end{mdframed}



Huge number of quotes about statistics commented it in sarcastic tone

$\rightarrow$ mostly hard to refute

## Really?
\LARGE
\textbf{However ...}

\vspace{0.5cm}

Statistics itself always provides useful information and allows us to maintain objective perspective based on DATA

## What is Statistics?

\large{So then, what is statistics??}

\vspace{0.5cm}
\begin{columns}
  \begin{column}{0.4\textwidth}
    \begin{center}
      \includegraphics[width = 2.5cm, height = 2.5cm]{StatisticsWords_Meg.jpg}
    \end{center}
  \end{column}
  \begin{column}{0.6\textwidth}
    \begin{center}
      \includegraphics[width = 4.8cm, height = 2.5cm]{wordcloud-biostatics.png}
    \end{center}
  \end{column}
\end{columns}

\tiny{$^{\dagger}$ Each wordcloud was cited from \href{http://blog.trident.edu/-temporary-slug-8756cc7e-1d1b-458e-94e2-3ff603f80c9e}{Trident University International} and \href{http://www.augusta.edu/mcg/dphs/biostats/research/index.php}{Augusta University}, respectively.}

\vspace{0.3cm}
\normalsize

\begin{tcolorbox}[colback=gray!10,colframe=black, title=\textbf{Statistics}]
Concerning with \textbf{collection}, \textbf{organization}, \textbf{summarization} and \textbf{analysis} of \textbf{DATA}
\end{tcolorbox}
<!--   -->


## Main Pillars of Statistics 
\LARGE

### The most important things in statistics 
\normalsize

1. Data (sample)
    - Investigation, experiment, and survey
    - Gathering numbers (for quantitative analysis)
2. Description or Summarization
    - Table, chart, and so on
    - Based on summarized statistics (e.g. mean, standard deviation, median, ...)
3. Inference
    - Numerous statistical tests and models based on probability theory
    - e.g. two-sample t-test, ANOVA, ANCOVA, regression, and so on

## Why should we collect data (sample)? 

### Measure everything from POPULATION

- Benefits
    - You will get exactly correct answer
    - No need to meet an awkward statistician LIKE ME

- If you had a plenty of 
    - Money (typing ``SHOW ME THE MONEY'' may help your budget)
    - Time (TOO SHORT TO COLLECT data of entire population)

### Inferential approach based on SAMPLE

  - If we have a proper sample that represents the whole population, you can get NEARLY the correct answer
  - Estimation and hypothesis testing

## Parameter vs. Estimates

### Parameter

Parameters exist somewhere in the universe $\rightarrow$ the true value representing the target population

From the view of \textit{frequentist}, 

  - Parameters are fixed $\rightarrow$ never changing
  - Parameters exists but we never know the true value of them
  - But we can ``guess'' them from sample

## Parameter vs. Estimates

### Estimates

 - Estimating parameters based on the given samples (data)
 - Estimates have a variation in accordance with different samples or data
 
\begin{mdframed}[backgroundcolor = gray!30]

The data is an aspect of the real world we have captured

\end{mdframed}
 
 - How good is our estimation?
    - Estimation inevitably involves \textbf{ERROR}
    - Error measures: standard error (SE) $\rightarrow$ reliability of an estimate

$$
  \mathrm{SE} = \frac{\sigma}{\sqrt{N}}
$$

\begin{mdframed}[backgroundcolor = gray!30]
\textbf{\textit{Measurement is ubiquitous $\rightarrow$ then error is also ubiquitous.}}
\end{mdframed}


## Type of variables

\textbf{Data consist of a set of independent sample and measured variables}
<!-- \rowcolors{2}{gray!6}{white} -->
\begin{table}
  \centering
  \caption{Types of variable based on their scales}
  \begingroup\footnotesize
  \begin{tabular}{lp{12em}p{8em}}
    \toprule
  \textbf{Scale}  &  \textbf{Example}                                                & \textbf{Operation} \\
    \midrule 
  \multicolumn{3}{L{5cm}}{\textbf{Qualitative (질적변수)}} \\
  \hspace{2.5mm} Nominal (명목)  & sex, marital status, blood type, race, eye colour, religion, ... & counting          \\ 
  \hspace{2.5mm} Ordinal (순서)  & grade, education level, preference, severity, ...                & counting, ranking \\
  \multicolumn{3}{L{5cm}}{\textbf{Quantitative (양적변수)}} \\
  \hspace{2.5mm} Interval (구간) & temperature, IQ, SAT score, ...                                  & counting, ranking, $+$, $-$ \\
  \hspace{2.5mm} Ratio (비율)    & distance, length, height, weight, BMI, blood pressure, ...       & counting, ranking, $+$, $-$, $\times$, $\div$ \\
  \bottomrule
  \end{tabular}
  \endgroup
\end{table}

## Can we separate types of variable clearly? 

Continuous variable is limited by the precision of the measurement

### Example

- Height: measured to the nearest centimeter $\rightarrow$ continuous variable?
- Age: measured to the year but theoretically, measured to any level of precision (e.g. month, day, and time)

\begin{mdframed}[backgroundcolor = gray!30]
In practice, all variables are discrete but some variables can be treated as continuous when its distribution can be well approximated by a continuous distribution.
\end{mdframed}

## How to express your data?

\begin{mdframed}[backgroundcolor = gray!30]
Data themselves are just a bunch of numbers $\rightarrow$ how to extract meaningful information from data?
\end{mdframed}

### Descriptive statistics 

- Summary statistics: all information of data are represented by a certain type of numbers
    - Example: mean, median, proportion, standard deviation, interquartile range, percentile, ... $\rightarrow$ developing ``\textit{statphobia}''

```{r summary-ex1, results = "asis"}
library(xtable)
library(reporttools)
options(xtable.timestamp = "")
options(xtable.comment = FALSE)

data(mpg)
df <- data.frame(mpg %>% select(displ, year, cyl, cty, hwy))
tableContinuous(vars = df, stats = c("n", "min", "q1", "median", "mean", "q3", "max", "s", "iqr"),
                caption.placement = "top", cap = "Descriptive statistics of ``mpg'' dataset", 
                lab = "tab:demo-1", longtable = F, table.placement = "H")
```

## How to express your data?

### Example of polar area diagram by Florence Nightingale (1820 $\sim$ 1910)

\begin{center}
  \includegraphics[width = 10cm, height = 6cm]{Nightingale-mortality.jpg}
\end{center}

## How to express your data?

### Example of data visualization

```{r mpg-example, message = F, fig.pos = "H", fig.width = 11, fig.height = 9, out.width = "8cm", out.height = "6cm", dpi = 250,  fig.align = "center", fig.cap = "Data visualization examples for ``mpg'' dataset. All plots are available at http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html"}
theme_set(theme_classic())
g <- ggplot(mpg, aes(cty))
g1 <- g + geom_density(aes(fill=factor(cyl)), alpha=0.8) + 
     labs(title="Density plot", subtitle="City Mileage Grouped by Number of cylinders",
          caption="Source: mpg", x="City Mileage", fill="# Cylinders") + 
  scale_fill_manual(values = c("white", "green", "orange", "red"))

theme_set(theme_bw())
g <- ggplot(mpg, aes(manufacturer, cty))
g2 <- g + geom_boxplot() + 
          geom_dotplot(binaxis='y', stackdir='center', dotsize = .5, fill="red") +
          theme(axis.text.x = element_text(angle=65, vjust=0.6)) + 
          labs(title="Box plot + Dot plot", subtitle="City Mileage vs Class: Each dot represents 1 row in source data",
               caption="Source: mpg", x="Class of Vehicle", y="City Mileage")
       
library(ggplot2)
theme_set(theme_bw())  # pre-set the bw theme.
g <- ggplot(mpg, aes(cty, hwy))
g3 <- g + geom_count(col="tomato3", show.legend=F) +
  labs(subtitle="mpg: city vs highway mileage", y="hwy", x="cty", title="Counts Plot")

library(ggplot2)
theme_set(theme_classic())
freqtable <- table(mpg$manufacturer)
df <- as.data.frame.table(freqtable)

g <- ggplot(df, aes(Var1, Freq))
g4 <- g + geom_bar(stat="identity", width = 0.5, fill="tomato2") + 
  labs(title="Bar Chart", subtitle="Manufacturer of vehicles", 
       caption="Source: Frequency of Manufacturers from 'mpg' dataset") + 
  theme(axis.text.x = element_text(angle=65, vjust=0.6))

grid.arrange(g1, g2, g3, g4, ncol = 2)
```

## How to express your data?

### Data visualization

\begin{mdframed}[backgroundcolor = gray!30]
Sometimes, a graph provides us more useful information than complex tables
\end{mdframed}

### Various types of statistical graphs

- Histogram, boxplot, Q-Q plot, scatterplot, ...
- Do NOT rely only on NUMBERS, Do draw a PLOT!!


## Is description of data fully enough?

Again, data are the small aspect of the real world. 

Statistical inference provides us more reasonable interpretation regarding to the uncertainty of data.

\begin{tcolorbox}[colback=gray!10,colframe=black, title=\textbf{Two main category of statistical inference}]
\begin{itemize}
  \item \textbf{Estimation}
  \item \textbf{Hypothesis testing}
\end{itemize}
\end{tcolorbox}


## Meaning of 95\% confidence interval 

```{r  message = F, fig.pos = "H", fig.width = 10, fig.height = 5, out.width = "10cm", out.height = "5cm", dpi = 250, fig.align = "center", fig.cap = "95\\% confidence intervals for 100 independent drawn samples with $n = 100$."}
smpl_mean_sample_ci <- function(n, p=0.95, pop_mean=0, pop_sd=1) {
  smpl <- rnorm(n, pop_mean, pop_sd)
  smpl_sd <- sd(smpl)
  smpl_mean <- mean(smpl)
  tailprob <- (1 - p) / 2
  q <- -qt(tailprob, df=(n - 1), lower.tail=TRUE)
  se <- smpl_sd / sqrt(n)
  ci <- data.frame(ci_lb = smpl_mean - q * se,
                   ci_ub = smpl_mean + q * se)
  ci
}

set.seed(19811202)
tmp2 <- rdply(100, smpl_mean_sample_ci(100, 95 / 100))
tmp2 <- tmp2 %>% 
  mutate(n = seq_len(100), 
         contains_mean = ((0 > ci_lb) & (0 < ci_ub)))

ggplot(tmp2, aes(x = n, ymin = ci_lb, ymax = ci_ub, colour = contains_mean)) + 
  geom_linerange(size = 1.2) + geom_hline(yintercept = 0, colour = "blue", linetype = "dashed", size = 0.5) + 
  scale_x_continuous("# of samples") + 
  scale_y_continuous(sprintf("%d%% Confidence interval", 95)) + 
  scale_colour_manual(values = c("red", "black")) + 
  annotate("text", x = 70, y = -0.5, label = sprintf("# of intervals containing true mean: %d", sum(tmp2$contains_mean)), hjust = 0) + 
  annotate("text", x = 70, y = -0.55, label = sprintf("# of intervals NOT containing true mean: %d", sum(!tmp2$contains_mean)), hjust = 0) + 
  theme(legend.position = "none",
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())
```


# Clinical Research

## Overview 

\LARGE{\textbf{Research or trial?}}

### Research

\normalsize{자료의 수집과 분석 목적이 학술적 목적에 국한된 모든 종류의 연구 및 실험}

### Trial

\normalsize{자료의 수집과 분석 목적이 이윤추구 또는 허가에 목적이 있는 임상시험}

## Observational Study

### Cross-sectional study (단면적 관찰연구)

1. prevalence study
2. Diagostic test
3. Ecological study 
4. Validity, Reliability, and agreement study

### Longitudinal study (종단적 관찰연구)

1. Prospective study
2. Retrospective study

## Experimental Study

### Randomized controlled trial 

### Pilot study

### Exploratory study

### Confirmative study


# Type of outcome variables

## Primary outcomes

## Secondary outcomes

## Surrogate variables

## Global assessment variable

# Sample size calculation

## Overview

### Two approaches

1. Based on the marginal error rate $\rightarrow$ population based observational study
2. Based on the effectiveness between concerning groups $\rightarrow$ experimental study
  
\textbf{Both approaches are based on previous studies}

\textbf{Is your study entirely new?}

## Observational study

## Observational study: prevalence study

## Observational study: prevalence study

## Parallel design

## $2\times 2$ cross-over design 

## Factorial design

# Multiple comparison

## What makes data significant?

1. Data themselves contain unexpected errors
2. Bias
3. Just conincidence
4. Our hypothesis is working

## Torturing data

# Statistical Analysis 

## Overview

## Independent two sample t-test

1. Too easy, but very useful methodology for the comparison of sample means between two groups

## Analysis of Variance (ANOVA)

## Analysis of Covariance (ANCOVA)

## Simple or multiple regression

## Repeated Measures ANOVA

## Linear mixed effects model 

## Reliability analysis 

### Cohen's $\kappa$

### Cronbach's $\alpha$

### Intra Class Correlation (ICC)










